<!DOCTYPE html>
<html>

<head>
    <title>解析剪切板 - 三条波浪线</title>
</head>

<body>

    <button class = "btn operate" onclick="btnOnclick()">合成网址，并开始看剧</button>

    <script>
        async function copyToClipboard(text) {
            var dummy = document.createElement("textarea");
            document.body.appendChild(dummy);
            dummy.value = text;
            dummy.select();
            document.execCommand("copy");
            document.body.removeChild(dummy);
        }

        async function readCopy() {
            return new Promise((resolve, reject) => {
                navigator.permissions
                .query({ name: "clipboard-read" })
                .then(result => {
                    if (result.state == "granted" || result.state == "prompt") {
                    navigator.clipboard.readText().then(
                        text => {
                            console.log("Clipboard text: ", text);
                            resolve(text);
                        },
                        error => {
                            console.error("Failed to read text: ", error);
                        }
                    );
                    }
                });
            });
        }

        async function btnOnclick() {
            var str = await readCopy();
            copyToClipboard("okjx.cc/?url=" + str);
        }

    </script>
</body>
</html>
